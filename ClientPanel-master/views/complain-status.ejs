<!-- Wappler include head-page="layouts/main" fontawesome_5="cdn" bootstrap5="local" is="dmx-app" id="complainstatus" appConnect="local" components="{dmxDatePicker:{},dmxBootstrap5TableGenerator:{},dmxDataTraversal:{},dmxStateManagement:{},dmxBootstrap5Modal:{}}" jquery_slim_35="cdn" moment_2="cdn" -->
<meta name="ac:route" content="/complain-status">
<dmx-query-manager id="qm"></dmx-query-manager>
<dmx-serverconnect id="scComplainStatus" url="api/Complain/ComplainStatus" dmx-param:offset="qm.data.offset" dmx-param:sort="qm.data.sort" dmx-param:dir="qm.data.dir" dmx-param:fromdate="content.formPendingDate.daterange.start" dmx-param:todate="content.formPendingDate.daterange.end"></dmx-serverconnect>

<dmx-data-view id="dvComplainStatus" dmx-bind:data="content.scComplainStatus.data.getComplainTr.data" filter="(user_number.contains(formSearchUser.Search.value) || tr_status.contains(formSearchUser.Search.value.uppercase()) || tr_id.contains(formSearchUser.Search.value) || remitter_id.contains(formSearchUser.Search.value) || bank_ac_no.contains(formSearchUser.Search.value))"></dmx-data-view>
<dmx-data-detail id="ddRechargeTrans" dmx-bind:data="dvComplainStatus.data" key="id"></dmx-data-detail>
<div class="row align-items-center justify-content-between px-4 mb-3 sd-secondary-header mx-0">
    <div class="col-12 col-md-auto me-auto ps-4">
        <h1 class="ms-md-1 mt-md-3 text-dark fs-2 sd-fw-800 d-flex align-items-center">
            Complain Status
            <span class="border-3 ms-2 spinner-border spinner-border-sm" role="status" dmx-show="scComplainStatus.state.executing"></span>
        </h1>
    </div>
    <div class="col-auto order-2 order-md-1 d-flex align-items-center justify-content-start justify-content-md-center px-0 px-lg-2">
        <form id="formPendingDate"><label class="sw-datepicker">
                <span class="btn bg-light"><img src="assets/images/icons/calendar.svg" class="img-fluid" width="20px"></span>
                <input type="text" is="dmx-date-range-picker" format="DD MMM YY" class="" placeholder="Nov 2021 - Dec 2021" id="daterange" dmx-bind:startdate="dateNow.datetime.addDays(0)" dmx-bind:enddate="dateNow.datetime.formatDate('yyyy-MM-dd 23:59:59')" autoapply="true">
            </label>
        </form>
    </div>
    <div class="col-auto order-1 order-md-3 d-flex align-items-center justify-content-center">
        <form id="formSearchUser" class="sd-search-form">
            <div class="d-flex justify-content-end mb-3 mb-lg-0 mb-md-0">
                <input type="text" class="form-control sd-search-input rounded-pill" id="Search" name="Search" placeholder="Search">
                <span class="bg-transparent btn position-absolute px-1 py-1"><i class="fas fa-search mb-1 mb-xl-0"></i></span>
            </div>
        </form>
    </div>
</div>
<div class="container px-4" id="Recharges">
    <div class="card">
        <div class="card-header sw-bg-col-primary">
            <b>Complain Status Report</b>
        </div>

        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover table-sm">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th class="sorting" dmx-on:click="qm.set('offset','operator_name');qm.set('sort',qm.data.sort == 'desc' ? 'asc' : 'desc')" dmx-class:sorting_asc="qm.data.offset=='operator_name' && qm.data.sort == 'asc'" dmx-class:sorting_desc="qm.data.offset=='operator_name' && qm.data.sort == 'desc'">Operator name</th>
                            <th class="sorting" dmx-on:click="qm.set('offset','user_number');qm.set('sort',qm.data.sort == 'desc' ? 'asc' : 'desc')" dmx-class:sorting_asc="qm.data.offset=='user_number' && qm.data.sort == 'asc'" dmx-class:sorting_desc="qm.data.offset=='user_number' && qm.data.sort == 'desc'">Mobile</th>
                            <th class="sorting" dmx-on:click="qm.set('offset','details');qm.set('sort',qm.data.sort == 'desc' ? 'asc' : 'desc')" dmx-class:sorting_asc="qm.data.offset=='details' && qm.data.sort == 'asc'" dmx-class:sorting_desc="qm.data.offset=='details' && qm.data.sort == 'desc'">Details</th>
                            <th class="sorting" dmx-on:click="qm.set('offset','amount');qm.set('sort',qm.data.sort == 'desc' ? 'asc' : 'desc')" dmx-class:sorting_asc="qm.data.offset=='amount' && qm.data.sort == 'asc'" dmx-class:sorting_desc="qm.data.offset=='amount' && qm.data.sort == 'desc'">Amount</th>
                            <th class="sorting" dmx-on:click="qm.set('offset','support_type');qm.set('sort',qm.data.sort == 'desc' ? 'asc' : 'desc')" dmx-class:sorting_asc="qm.data.offset=='support_type' && qm.data.sort == 'asc'" dmx-class:sorting_desc="qm.data.offset=='support_type' && qm.data.sort == 'desc'">Support type</th>
                            <th class="sorting" dmx-on:click="qm.set('offset','tr_status');qm.set('sort',qm.data.sort == 'desc' ? 'asc' : 'desc')" dmx-class:sorting_asc="qm.data.offset=='tr_status' && qm.data.sort == 'asc'" dmx-class:sorting_desc="qm.data.offset=='tr_status' && qm.data.sort == 'desc'">Tr. Status</th>
                            <th class="sorting" dmx-on:click="qm.set('offset','tr_id');qm.set('sort',qm.data.sort == 'desc' ? 'asc' : 'desc')" dmx-class:sorting_asc="qm.data.offset=='tr_id' && qm.data.sort == 'asc'" dmx-class:sorting_desc="qm.data.offset=='tr_id' && qm.data.sort == 'desc'">Tr. Id</th>
                            <th class="sorting" dmx-on:click="qm.set('offset','remitter_id');qm.set('sort',qm.data.sort == 'desc' ? 'asc' : 'desc')" dmx-class:sorting_asc="qm.data.offset=='remitter_id' && qm.data.sort == 'asc'" dmx-class:sorting_desc="qm.data.offset=='remitter_id' && qm.data.sort == 'desc'">Remitter</th>
                            <th class="sorting" dmx-on:click="qm.set('offset','bank_ac_no');qm.set('sort',qm.data.sort == 'desc' ? 'asc' : 'desc')" dmx-class:sorting_asc="qm.data.offset=='bank_ac_no' && qm.data.sort == 'asc'" dmx-class:sorting_desc="qm.data.offset=='bank_ac_no' && qm.data.sort == 'desc'">Bank ac no</th>
                            <th class="sorting" dmx-on:click="qm.set('offset','message');qm.set('sort',qm.data.sort == 'desc' ? 'asc' : 'desc')" dmx-class:sorting_asc="qm.data.offset=='message' && qm.data.sort == 'asc'" dmx-class:sorting_desc="qm.data.offset=='message' && qm.data.sort == 'desc'">Message</th>
                            <th class="sorting" dmx-on:click="qm.set('offset','adddate');qm.set('sort',qm.data.sort == 'desc' ? 'asc' : 'desc')" dmx-class:sorting_asc="qm.data.offset=='adddate' && qm.data.sort == 'asc'" dmx-class:sorting_desc="qm.data.offset=='adddate' && qm.data.sort == 'desc'">Adddate</th>
                            <th class="sorting" dmx-on:click="qm.set('offset','complain_status');qm.set('sort',qm.data.sort == 'desc' ? 'asc' : 'desc')" dmx-class:sorting_asc="qm.data.offset=='complain_status' && qm.data.sort == 'asc'" dmx-class:sorting_desc="qm.data.offset=='complain_status' && qm.data.sort == 'desc'">Complain status</th>
                            <th class="sorting" dmx-on:click="qm.set('offset','response');qm.set('sort',qm.data.sort == 'desc' ? 'asc' : 'desc')" dmx-class:sorting_asc="qm.data.offset=='response' && qm.data.sort == 'asc'" dmx-class:sorting_desc="qm.data.offset=='response' && qm.data.sort == 'desc'">Response</th>
                            <th class="sorting" dmx-on:click="qm.set('offset','reply_date');qm.set('sort',qm.data.sort == 'desc' ? 'asc' : 'desc')" dmx-class:sorting_asc="qm.data.offset=='reply_date' && qm.data.sort == 'asc'" dmx-class:sorting_desc="qm.data.offset=='reply_date' && qm.data.sort == 'desc'">Reply date</th>
                        </tr>
                    </thead>
                    <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="content.dvComplainStatus.data" id="tableRepeat1" dmx-state="qm" dmx-sort="offset" dmx-order="sort" key="id">
                        <tr>
                            <td>{{$index+1}}</td>
                            <td dmx-text="operator_name"></td>
                            <td dmx-text="user_number"></td>
                            <td dmx-text="details"></td>
                            <td dmx-text="amount"></td>
                            <td dmx-text="support_type"></td>
                            <td class="fw-bold" dmx-text="tr_status" dmx-class:text-success="tr_status == 'SUCCESS'" dmx-class:text-warning="tr_status == 'PENDING'" dmx-class:text-danger="tr_status == 'FAILED'" dmx-class:text-primary="tr_status == 'REFUND'"></td>
                            <td dmx-text="tr_id"></td>
                            <td dmx-text="remitter_id"></td>
                            <td dmx-text="bank_ac_no"></td>
                            <td dmx-text="message"></td>
                            <td dmx-text="adddate.formatDate('dd-MM-yyyy hh:mm:ss A')"></td>
                            <td dmx-text="complain_status==1?'Open':'Closed'" dmx-class:text-success="complain_status == 1" dmx-class:text-danger="complain_status == 2 || complain_status == 3"></td>
                            <td dmx-text="response"></td>
                            <td dmx-text="reply_date.formatDate('dd-MM-yyyy hh:mm:ss A')"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="modal fade fixed-left sd-right-sidebar-40" id="modalFilter" is="dmx-bs5-modal" tabindex="-1">
    <div class="modal-dialog modal-dialog-aside my-0 modal-lg" role="document">
        <div class="modal-content rounded-0 px-3">
            <div class="modal-header border-0 pb-0">
                <h3 class="modal-title">Filter By</h3>
                <button type="button" class="bg-transparent border-0 ms-auto p-0 px-1" data-bs-dismiss="modal" aria-label="Close">
                    <i class="fas fa-times" alt="icon"></i>
                </button>
            </div>
            <div class="modal-body py-0">
                <form id="filterForm1" method="post">
                    <div class="row align-items-baseline">
                        <div class="col-6 col-md-3">
                            <label for="inpFromDate" class="form-label text-black sd-fw-600">From Date</label>
                            <input type="date" name="fromdate" id="inpFromDate" class="form-control" required="">
                        </div>
                        <div class="col-6 col-md-3">
                            <label for="inpToDate" class="form-label text-black sd-fw-600"> To Date</label>
                            <input type="date" name="todate" id="inpToDate" class="form-control" required="">
                        </div>
                        <div class="col-6 col-md-2">
                            <label for="inpSelectStatus" class="form-label text-black sd-fw-600">Status</label>
                            <select id="selectStatus" class="form-control" name="Status">
                                <option value="0">All</option>
                                <option value="SUCCESS">Success</option>
                                <option value="FAILURE">Failure</option>
                                <option value="REFUND">Refund</option>
                            </select>
                        </div>
                        <div class="col-6 col-md-2">
                            <button id="applyFilters" class="btn btn-primary mt-5 px-1 sd-fw-300 text-white" dmx-on:click="scComplainStatus.load({fromdate: modalFilter.filterForm1.inpFromDate.value+' 00:00:00', todate: modalFilter.filterForm1.inpToDate.value+' 23:59:59.999', selectstatus: modalFilter.filterForm1.selectStatus.value, transfilter: 1})" data-bs-dismiss="modal" aria-label="Close">
                                Apply Filters</button>
                        </div>
                        <div class="col-6 col-md-2">
                            <button id="clearFilters" type="button" class="btn btn-dark mt-5 px-1 sd-fw-300 text-light" dmx-on:click="filterForm1.reset();scComplainStatus.load({},true);">Clear Filters</button>
                        </div>
                    </div>
                </form>
                <div class="border-divider mb-4"></div>

            </div>
        </div>
    </div>
</div>